
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galactic Medias</title>
<link rel="icon" href="../../../images/favicon.html" type="image/png">
<link rel="stylesheet" href="css/fonts129e.css?v=1.7">
<link rel="stylesheet" href="css/bootstrap.min129e.css?v=1.7">
<link rel="stylesheet" href="css/jquery-ui.min129e.css?v=1.7">
<link rel="stylesheet" href="css/lightbox.min129e.css?v=1.7">
<link rel="stylesheet" href="css/spectrum.min129e.css?v=1.7">
<link rel="stylesheet" href="css/videoPlayer129e.css?v=1.7">
<link rel="stylesheet" href="css/style129e.css?v=1.7">
<link rel="stylesheet" href="css/videoEditor129e.css?v=1.7">
<link rel="stylesheet" href="css/new-style129e.css?v=1.7"></head>
<style>
    
.fullscreen-div {
  position: fixed;
  top: 0;
  left: 0;
  display: flex;
  max-width: 675px;
  max-height: 320px;
  /*z-index: 400; */

}

.ai_container {
  position: relative;
  max-width: 675px;
  max-height: 320px;
    /*z-index: 400; */
}

.ai_container video, .ai_container canvas, .canvas-container {
  position: absolute;
  top: 0;
  left: 0;
  max-width: 675px;
  max-height: 320px;
    /*z-index: 400; */
}
    input[type="submit"] {
    height: 37px;
    line-height: 37px;
    border-radius: 6px;
    background: #151515;
    color: #fff;

  }
#message-input { 
    resize: both !important; width: 100%;
    max-width: 800px;
    box-sizing: border-box;
    resize: both;    
    border-radius: 6px;
    background: #151515;
    color: #fff;
   }
  
#myDiv {
    position: fixed;
    top: -45%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 600px;
    height: 30px;
    opacity: .7;
    background-color: lightgreen ;
    border-radius: 6px;
    font-weight: bold;
}

</style>
<body class="full-screen">
           <form id="message-form"
            style="display: flex; text-align: center; position: fixed; bottom: 60px; left: 55%; transform: translateX(-50%); z-index: 20; right: 0;max-height: 36px;">
            <label for="message-input"></label><br>
            <textarea id="message-input" name="message" class="message-input1"></textarea>
            <input type="submit" value="Submit">
                <div id="myDiv"></div>

            <input type="file" style="display: none;">
            <button title="upload audio, video or any image supports mp3, mp4, etc"
                style="background-color: rgba(255, 255, 255, 0.5); color: white; padding: 5px; border-radius: 5px; display: flex; margin-right: 5px; max-width: 35px; max-height: 37px;">
                <span
                    style="display: none; position: absolute; background-color: rgb(0, 166, 126); color: white; padding: 5px; border-radius: 5px;">upload
                    most of the audio, video or any image and it supports mp3, mp4, etc</span><svg width="24" height="24"
                    viewBox="0 0 24 24">
                    <path
                        d="M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5s-2.24-5-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"></path>
                </svg>
            </button>
            <input type="file" style="display: none;">
            <button title="Share"
                style="background-color: rgba(255, 255, 255, 0.5); color: white; padding: 5px; border-radius: 5px; display: flex; margin-right: 5px; max-width: 35px; max-height: 37px;">
                <span
                    style="display: none; position: absolute; background-color: rgb(0, 166, 126); color: white; padding: 5px; border-radius: 5px; top: 70px;">Chat</span><svg
                    width="24" height="24" viewBox="0 0 24 24">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="black"
                        class="bi bi-chat-left-text" viewBox="0 0 16 16">
                        <path
                            d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"></path>
                        <path
                            d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"></path>
                    </svg>
                </svg>
            </button>
            <input type="file" style="display: none;">
            <button title="Share"
                style="background-color: rgba(255, 255, 255, 0.5); color: white; padding: 5px; border-radius: 5px; display: flex; margin-right: 5px; max-width: 35px; max-height: 37px;">
                <span
                    style="display: none; position: absolute; background-color: rgb(0, 166, 126); color: white; padding: 5px; border-radius: 5px; top: 70px;">Share</span><svg
                    width="24" height="24" viewBox="0 0 24 24">
                    <path
                        d="M 18 2 A 3 3 0 0 0 15 5 A 3 3 0 0 0 15.054688 5.5605469 L 7.9394531 9.7109375 A 3 3 0 0 0 6 9 A 3 3 0 0 0 3 12 A 3 3 0 0 0 6 15 A 3 3 0 0 0 7.9355469 14.287109 L 15.054688 18.439453 A 3 3 0 0 0 15 19 A 3 3 0 0 0 18 22 A 3 3 0 0 0 21 19 A 3 3 0 0 0 18 16 A 3 3 0 0 0 16.0625 16.712891 L 8.9453125 12.560547 A 3 3 0 0 0 9 12 A 3 3 0 0 0 8.9453125 11.439453 L 16.060547 7.2890625 A 3 3 0 0 0 18 8 A 3 3 0 0 0 21 5 A 3 3 0 0 0 18 2 z"></path>
                    </svg>
            </button>
        </form>
        
<div class="close-wrapper"></div>
<section class="all-content p-0">
<div class="video-editor row p-0 m-0">
<div class="video-options-bar col-12">
<div class="video-options">
<div class="single-option" data-target="#videos">
<i class="fas fa-video"></i>
<span class="name">Videos</span>
</div>
<div class="single-option" data-target="#category-7">
<i class="far fa-images"></i> <span class="name">
Backgrounds</span>
</div>
<div class="single-option" data-target="#category-11">
<i class="far fa-heart"></i> <span class="name">
Clip Arts</span>
</div>
<div class="single-option" data-target="#category-14">
<i class="far fa-grin-hearts"></i> <span class="name">
Emojis</span>
</div>
<div class="single-option" data-target="#category-15">
<i class="fab fa-connectdevelop"></i> <span class="name">
Icons</span>
</div>
<div class="single-option" data-target="#text-panel">
<i class="fas fa-font"></i>
<span class="name">text</span>
</div>
<div class="single-option" data-target="#drawing">
<i class="fas fa-paint-brush"></i>
<span class="name">Drawing</span>
</div>
<div class="single-option" data-target="#image">
<i class="fas fa-image"></i>
<span class="name">Image</span>
</div>
<div class="single-option ml-auto" id="save-video">
<i class="far fa-save"></i>
<span class="name">Export</span>
</div>
</div>
</div>

<div class="clear-overlay-library"></div>
<div class="col-md-6 library px-0">
<div class="panel scrollbar scrollbar_dark" id="videos">
<div class="pull-away">
<h3 class="heading">Videos</h3>
<label class="import-file-label cp">
<input type="file" class="import-video-file d-none" accept="video/*" multiple>
<i class="fas fa-arrow-down"></i> Import
</label>
</div>
<div class="no-data-found content-center">
<div class="content text-center">
<i class="fas fa-video large-icon"></i>
<p class="more mt-2">Drag and Drop files here</p>
<p class="more">OR</p>
<label class="import-file-label cp" for="input-video-file">
<span class="btn submit-btn"><i class="fas fa-plus"></i> Browse Files</span>
</label>
</div>
</div>
<div class="dragOverlay">
<p class="more"><i class="fas fa-plus"></i> Add Files</p>
</div>
<div class="overlay-loader">
<div class="loader">
<span class="load load1"></span>
<span class="load load2"></span>
<span class="text">Loading</span>
</div>
</div>
<div class="row paginationData">
</div>
</div>
<div class="panel scrollbar scrollbar_dark" id="images">
<div class="pull-right" for="input-video-file">
<label class="p-2 import-file-label cp">
<i class="fas fa-arrow-down"></i> Import
</label>
</div>
<div class="row paginationData">
</div>
</div>
<input type="file" class="import-video-file d-none" id="input-video-file" accept="video/*" multiple>
<div class="panel scrollbar scrollbar_dark mediaPanel" id="category-7">
<h3 class="heading">Backgrounds</h3>
<div class="form-group">
<div class="input-group">
<span class="input-group-text"><i class="fas fa-search"></i></span>
<input type="text" placeholder="Search...." class="form-control search-query" data-action="fetchUserMedia" data-target="category-7">
</div>
</div>
<div class="row paginationData">
<div class="loader-container">
<div class="loader">
<span class="load load1"></span>
<span class="load load2"></span>
<span class="text">Loading</span>
</div>
</div>
</div>
</div>
<div class="panel scrollbar scrollbar_dark mediaPanel" id="category-11">
<h3 class="heading">Clip Arts</h3>
<div class="form-group">
<div class="input-group">
<span class="input-group-text"><i class="fas fa-search"></i></span>
<input type="text" placeholder="Search...." class="form-control search-query" data-action="fetchUserMedia" data-target="category-11">
</div>
</div>
<div class="row paginationData">
<div class="loader-container">
<div class="loader">
<span class="load load1"></span>
<span class="load load2"></span>
<span class="text">Loading</span>
</div>
</div>
</div>
</div>
<div class="panel scrollbar scrollbar_dark mediaPanel" id="category-14">
<h3 class="heading">Emojis</h3>
<div class="form-group">
<div class="input-group">
<span class="input-group-text"><i class="fas fa-search"></i></span>
<input type="text" placeholder="Search...." class="form-control search-query" data-action="fetchUserMedia" data-target="category-14">
</div>
</div>
<div class="row paginationData">
<div class="loader-container">
<div class="loader">
<span class="load load1"></span>
<span class="load load2"></span>
<span class="text">Loading</span>
</div>
</div>
</div>
</div>
<div class="panel scrollbar scrollbar_dark mediaPanel" id="category-15">
<h3 class="heading">Icons</h3>
<div class="form-group">
<div class="input-group">
<span class="input-group-text"><i class="fas fa-search"></i></span>
<input type="text" placeholder="Search...." class="form-control search-query" data-action="fetchUserMedia" data-target="category-15">
</div>
</div>
<div class="row paginationData">
<div class="loader-container">
<div class="loader">
<span class="load load1"></span>
<span class="load load2"></span>
<span class="text">Loading</span>
</div>
</div>
</div>
</div>
<div class="panel scrollbar scrollbar_dark" id="text-panel">
<h3 class="heading">Text</h3>
<div class="py-3 m-0">
<span class="label">Enter Text</span>
<div class="form-group col-lg-8 px-0">
<input type="text" class="form-control text" placeholder="Enter text here....">
</div>
<div class="form-group">
<button type="button" class="s_btn add-text"><i class="fa fa-plus"></i> Add</button>
</div>
</div>
</div>

<div class="panel scrollbar scrollbar_dark additional-form" id="drawing">
<h3 class="heading">Drawing</h3>
<div class="py-3 m-0">
<div class="form-group" style="margin-top: 20px;">
<div class="col-4"><span class="label">Brush Color</span></div>
<div class="col-lg-6 col-8 d-flex">
<input type="text" class="form-control color-picker brush-color" data-default="#fff">
</div>
</div>
<div class="form-group">
<div class="col-4"><span class="label">Brush Width</span></div>
<div class="col-lg-6 col-8 d-flex">
<input type="range" class="rangeSlider brush-width" min="1" max="50" id="customRange1" value="10">
</div>
</div>
<div class="form-group">
<div class="col-12">
<button class="s_btn drawing-btn">Start Drawing</button>
</div>
</div>
</div>
</div>
<div class="panel scrollbar scrollbar_dark additional-form" id="image">
<h3 class="heading">Image</h3>
<div class="py-3 m-0">
<div class="form-group">
<div class="col-4">
<span class="label">Image Upload</span>
</div>
<div class="col-lg-6 col-8">
<input type="file" name="image-upload" class="editor-image-upload" accept="image/*">
</div>
</div>
</div>
<div class="row paginationData">
</div>
</div>
<div class="panel scrollbar scrolbar_dark p-4 additional-form" id="editing-panel">
<h3 class="heading">Editing</h3>
<div class="form-group">
<div class="col-4"><span class="label">Fill Color</span></div>
<div class="col-lg-6 col-8 d-flex">
<input type="text" class="form-control color-picker fill-color" data-default="#fff">
</div>
</div>
<div class="stroke-options disable">
<div class="form-group">
<div class="col-4"><span class="label">Stoke Color</span></div>
<div class="col-lg-6 col-8 d-flex">
<input type="text" class="form-control color-picker stroke-color" data-default="#000">
</div>
</div>
<div class="form-group">
<div class="col-4"><span class="label">Stoke Width</span></div>
<div class="col-lg-6 col-8 d-flex">
<input type="range" class="rangeSlider stroke-width" min="0" max="20" id="customRange1" value="0">
</div>
</div>
<div class="form-group">
<div class="col-4"><span class="label">Opacity</span></div>
<div class="col-lg-6 col-8 d-flex">
<input type="range" class="rangeSlider opacity" min="0" max="10" id="customRange1" value="10">
</div>
</div>
<div class="form-group text-group">
<div class="col-4"><span class="label">Text</span></div>
<div class="col-lg-6 col-8 d-flex">
<input type="text" class="form-control shape-text">
</div>
</div>
</div>
</div>
</div>
<div class="col-md-6 video-preview">
<div class="video h-100">
<div class="videoplayer">
<div class="vidoe-palyer-options">
<div class="controllers pull-away p-1 px-2 no-cursor">
<div class="videoplayer-time videoplayer-time-current">00:00</div>
<div class="videoplayer-time videoplayer-time-duration"> </div>
</div>
<div class="controllers">
<div class="videoplayer-bar">
<div class="videoplayer-bar-played" style="width: 0%;"></div>
</div>
</div>
<div class="controllers pull-away btm-options">
<div class="aic">
<div class="videoplayer-playpause"><a href="#"></a></div>
<div class="videoplayer-stop"></div>
</div>
<div style="display: flex;">
<div class="videoplayer-volume">
<div class="videoplayer-volume-button" title><a href="#"></a></div>
<div class="videoplayer-volume-adjust">
<input type="range" class="volume-range" min="1" max="100" value="100">
</div>
</div>
</div>
</div>
</div>
<div class="preventOverlay"></div>
<canvas id="canvasEditing" class="current"></canvas>
</div>
</div>
</div>
<div class="clearfix col-12 editing-options">
<span class="option delete-item disabled">
<i class="far fa-trash-alt"></i> Delete
</span>
<span class="option split-video disabled">
<img src="images/icons/cut.svg"> Split
</span>
<span class="video-export-timer"></span>
</div>
<div class="col-12 editing-area">
<div class="d-flex p-0 h-100">
<div class="col-12 px-0 editing-area-con scrollbar scrollbar_dark">
<div class="video-slider-label"></div>
<div class="video-area edit-area">
<div class="hoverLabel">
<img src="images/label-timeline.png">
</div>
</div>
<div class="img-area edit-area">
<div class="hoverLabel">
<img src="images/label-timeline.png">
</div>
</div>
<div class="video-slider"><span class="thumb"></span></div>
</div>
</div>
</div>
</div>
</section>
<div class="footer">
<a href="admin/login.html" class="submit-btn credits-btn" target="_blank">Admin</a>
</div>
<div class="videoAlert">
<div class="content">
<h2 class="heading">Message</h2>
<div class="body"></div>
<div class="foot"><button class="ok-btn btn btn-primary">Ok</button></div>
</div>
</div>

<div class="overlay-loader big-loader">
<div class="loader">
<span class="load load1"></span>
<span class="load load2"></span>
<span class="text">Loading</span>
</div>
</div>
<script type="6d29196527242537e9904f03-text/javascript">
        const ENV = "";
</script>
<script src="js/source/script-v1.7.min129e.js?v=1.7" type="6d29196527242537e9904f03-text/javascript"></script>
<script src="js/source/script-index-v1.7.min129e.js?v=1.7" type="6d29196527242537e9904f03-text/javascript"></script>
<script  src="../../../cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="6d29196527242537e9904f03-|49" defer></script>
<script src = "https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.9.8/dist/ffmpeg.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fabric"></script>
<script> 

        




    document.querySelector('div[data-target="#category-7"]').addEventListener('click', function(e) {
        document.querySelector('.fa-search').addEventListener('click', function(e) {
            var input = document.querySelector('.search-query');
    
            let keyword = document.querySelector('.search-query').value
    
            let imageUrl = `https://source.unsplash.com/102x44/?${encodeURIComponent(keyword)}`;
            console.log(imageUrl);
            imageUrls.push(imageUrl);
            let div = document.querySelector("#category-7 > div.row.paginationData")
            console.log(div)
            let img = document.createElement('img');
            img.crossOrigin = 'anonymous'; 
    
            img.src = imageUrl;
            
            img.addEventListener('load', () => {
              console.log('Image loaded successfully!');
            });
            
            img.addEventListener('error', () => {
              console.log('Error loading image');  
            });
            
            div.appendChild(img);
                });
            });
        
    function waitForElement(selector, callback) {
            
            if (document.querySelector(selector)) {
                callback();
            }
            
            setTimeout(function() {
                waitForElement(selector, callback);
            }, 1000);
    }
    
    waitForElement(".addToTimeline", function() {
        var addToTimelineButton = document.querySelector(".addToTimeline");
        // console.log(addToTimelineButton)
        addToTimelineButton.replaceWith(addToTimelineButton.cloneNode(true));
        addToTimelineButton = document.querySelector(".addToTimeline");
        otherButton = document.querySelector("body > button:nth-child(18)")
        addToTimelineButton.addEventListener('click', function() {
        // otherButton.click();
        var checkInterval = setInterval(function() {
            console.log(videoUrls)
            console.log(videoUrls.length)
            if (videoUrls && videoUrls.length > 0) { 
                console.log("button clicked");
                console.log(otherButton);
                // otherButton.click();
                console.log(checkInterval)
                clearInterval(checkInterval);
                console.log(checkInterval)
            }
            else {
                console.log("videoUrls is not defined or empty");
            }
        }, 1000);
      });
    });
        
    window.addEventListener('message', function(event) {
        if (event.origin !== 'https://buttoned-luminous-shirt.glitch.me') return;
        console.log('Received message:', event.data);
    });
    
    var numVideosToMerge;
    var input_video = document.createElement('input');
    input_video.type = 'file';
    input_video.id = 'input_video';
    console.log('input_video :>> ', input_video);
    var start_time = document.createElement('input');
    start_time.type = 'number';
    start_time.id = 'start_time';
    start_time.value = '1';
    
    var end_time = document.createElement('input');
    end_time.type = 'number';
    end_time.id = 'end_time';
    end_time.value = '2';
    
    var splitButton = document.querySelector('.split-video');
    console.log('splitButton :>> ', splitButton);
    var trimButton = document.querySelector('.trimming_button');

    console.log("video trimmed ");

    var button = document.createElement('button');
    button.innerHTML = 'Trim Video';
    button.className = 'trimming_button';
    button.onclick = function() { trimVideo(); };
    splitButton.onclick = function() { trimVideo(); };
    
    var output_video = document.createElement('video');
    output_video.id = 'output_video';
    
    output_video.controls = true;
    console.log('document.body :>> ', document.body);
    
    document.body.appendChild(input_video);
    document.body.appendChild(start_time);
    document.body.appendChild(end_time);
    document.body.appendChild(button);
    document.body.appendChild(output_video);
    
        var videoUrls = [];
        var videoNames = [];
        var formats = [];
        
var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
        if (mutation.type === 'childList') {
            var videoDivs = document.querySelectorAll('.single-media.video-file');
            videoDivs.forEach(function(videoDiv) {
                var videoUrl = videoDiv.getAttribute('data-for-video');
                var videoName = videoDiv.getAttribute('title'); // get the video name from the title attribute
                // console.log(videoName)
                // alert(videoName)
                if (!videoUrls.includes(videoUrl)) { 
                    videoUrls.push(videoUrl);
                    videoNames.push(videoName); 
                    var fileParts = videoName.split('.');
                    var format = fileParts[fileParts.length - 1];
                    console.log(`A new video has been added: ${videoUrl}`);
                    console.log(`Video name: ${videoName}`);
                    console.log(`Format: ${format}`);
                    formats.push(format)
                }
            });
        }
    });
});

var config = { attributes: true, childList: true, subtree: true };
observer.observe(document, config);

    var addButton = document.createElement("button");
    addButton.innerHTML = "Add Video";
    console.log(addButton)
    addButton.id = "add_video";

    document.body.appendChild(addButton);
    console.log(addButton)
    var mergeButton = document.createElement("button");
    mergeButton.innerHTML = "Merge Videos";
    document.body.appendChild(mergeButton);
    var downloadLink = document.createElement("a");
    console.log(downloadLink)
    downloadLink.innerHTML = "Download Merged Video";
    document.body.appendChild(downloadLink);
    
    var targetNode = document.querySelector('body');
    
    var config = { childList: true, subtree: true };
    var callback = function(mutationsList, observer) {
        for(let mutation of mutationsList) {
            if (mutation.type === 'childList') {
                let button = Array.from(document.querySelectorAll('a[download="output.mp4"]')).find(a => a.textContent === "Download Merged Video");
                if(button){
                    setTimeout(function() {
                        button.click();

                        observer.disconnect();
                    }, 500);
                }
            }
        }
    };
    
    var observer = new MutationObserver(callback);

    observer.observe(targetNode, config);

    const { createFFmpeg, fetchFile } = FFmpeg;
    
    const ffmpeg = createFFmpeg({ log: true });
    var videoUrls = [];

function  trimVideo(startTime, endTime)  {
var startTime;
var endTime;
var videoArea = document.querySelector('.video-area');
var slider = document.querySelector('.video-slider');
var videos = Array.from(videoArea.querySelectorAll('.single-item'));

function getVideoPortions(video, slider) {
    var videoRect = video.getBoundingClientRect();
    var sliderRect = slider.getBoundingClientRect();
    if (sliderRect.left >= videoRect.left && sliderRect.right <= videoRect.right) {

    var originalDiv = document.querySelector('.single-item');
    var newDiv = document.createElement('div');
    newDiv.className = 'single-item without-events';
    
    originalDiv.parentNode.insertBefore(newDiv, originalDiv.nextSibling);

        return {
            left: sliderRect.left - videoRect.left,
            right: videoRect.right - sliderRect.right
        };
    
    } 
    return null;
}

function findPortions() {
    videos.forEach(function(video) {
        var portions = getVideoPortions(video, slider);

        if (portions) {
            start_time.value = '0';
            end_time.value = portions.left;
        }
    });
}

findPortions();

    let videoDiv = document.querySelector('.single-media.video-file');
    let blobUrl = videoDiv.getAttribute('data-for-video');
    fetch(blobUrl)
    .then(response => response.blob())
    .then(blob => {
        startTime = 
        startTime || 
        document.querySelector('#start_time').value * (138.6 / 454.3);
        endTime = 
        endTime || 
        document.querySelector('#end_time').value * (138.6 / 454.3);
        let reader = new FileReader();
        reader.readAsDataURL(blob);
        reader.onloadend = function() {
            let base64data = reader.result;
            fetch('https://capricious-adaptable-van.glitch.me/trim', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    'input_video': base64data,
                    'start_time': startTime ? parseInt(startTime) : 0, 
                    'end_time': endTime ? parseInt(endTime) : parseInt(document.querySelector('#end_time').value * (138.6 / 454.3)) // Use the value from the query selector as default end time
                })
            })   
            .then(response => response.blob())
            .then(data => {
            var videoUrl = URL.createObjectURL(data);
            videoUrls.push(videoUrl);
            document.querySelector('#output_video').src = videoUrl;
            console.log('Video duration: ', document.querySelector('#output_video').duration);
            console.log('Video duration: ', videoUrl.duration);
            var newDiv = document.createElement('div');
            newDiv.className = 'single-item without-events';
            var newVideo = document.createElement('video');
            newVideo.style.width = '100%';
            newVideo.style.maxHeight = '100%';
            newVideo.addEventListener('loadedmetadata', function() {
                newDiv.appendChild(newVideo);
                document.querySelector('.video-area').appendChild(newDiv);
            });
            newVideo.src = videoUrl;
        
            var downloadLink = document.createElement('a');
            downloadLink.href = videoUrl;
            downloadLink.download = 'trimmed_video.mp4';
            downloadLink.textContent = 'Download video';
            document.body.appendChild(downloadLink);
            })
            .catch(error => console.error(error));
        }
    })
    .catch(error => console.error('Error:', error));
    }
   
    addButton.addEventListener('click', function() {
    var videoInput = document.createElement("input");
    videoInput.type = "file";
    videoInput.accept = "video/*";
    document.body.appendChild(videoInput);
    
    videoInput.onchange = function() {
        var file = this.files[0];
        var url = URL.createObjectURL(file);
        videoUrls.push(url);
        console.log('videoUrls :>> ', videoUrls);
        var videoDiv = document.createElement("div");
        videoDiv.className = "single-item without-events";
        var imgDiv = document.createElement("div");
        imgDiv.className = "img";
        videoDiv.appendChild(imgDiv);
        var imgElem = document.createElement("img");
        imgElem.src = "images/label-timeline.png";
        var videoElem = document.createElement("video");
        videoElem.src = url;
        videoElem.controls = true;
        videoElem.style.maxHeight = "100%";
        videoElem.setAttribute('data-for-video', url); 
        videoElem.className = "single-media video-file";
        videoElem.id = "added-video"; 
        imgDiv.appendChild(videoElem);
        var videoArea = document.querySelector(".video-area.edit-area.ui-sortable");
        console.log('videoArea :>> ', videoArea);
        videoArea.appendChild(videoDiv);
        videoElem.addEventListener('loadedmetadata', function() {
            var duration = videoElem.duration;
            videoElem.style.width = (duration * 7) + "px";
            console.log('videoElem :>> ', videoElem);
            otherButton = document.querySelector("body > button:nth-child(18)")
            var checkInterval = setInterval(function() {
            if (videoUrls && videoUrls.length > 0) { // Check if videoUrls is defined and not empty
                console.log("button clicked");
                otherButton.click();
                clearInterval(checkInterval);
            } else {
                console.log("videoUrls is not defined or empty");
            }
        }, 1000); 
        }); 
    };     

    videoInput.click()

    function VideoElement(file, videoAreaSelector) {
        this.file = file;
        this.url = URL.createObjectURL(this.file);
        this.videoAreaSelector = videoAreaSelector;
        this.element = null;
    }
    
    var file = videoInput.files[0];
    console.log(videoInput)
    console.log(file)
    if (file) {
        var videoElement = new VideoElement(file, ".video-area.edit-area.ui-sortable");
        videoElement.create();
        videoElement.appendToVideoArea();
    }
    else {
        console.error('No file selected');
    }

    var thumb = document.querySelector("body > section > div > div.col-12.editing-area > div > div > div.video-slider .thumb");
    var sliderElement = document.querySelector("body > section > div > div.col-12.editing-area > div > div > div.video-slider");
        var line = document.createElement("div");
        console.log(line)
        line.style.width = "0.1px";
        line.style.height = '50px';
        line.style.backgroundColor = "white";
        line.style.position = "absolute";
        // line.style.bottom = "0";
        sliderElement.appendChild(line);
    
    var isMouseDown = false;
    
    thumb.addEventListener("mousedown", function(event) {
        isMouseDown = true;
    }); 
    
    window.addEventListener("mouseup", function(event) {
        isMouseDown = false;
    });
    
    sliderElement.addEventListener("mousemove", function(event) {
        if (isMouseDown) {
            var x = (event.clientX - sliderElement.getBoundingClientRect().left);
            thumb.style.transform = "translateX(" + x + "px)";
            line.style.transform = "translateX(" + x + "px)";
    
            var slider = document.querySelector('.video-slider');
            slider.style.transform = "translateX(" + x + "px)";
            // console.log('slider4444444444 :>> ', slider);
        }
      }); 
    });

    async function mergeVideos(numVideos) {
  console.log(numVideos)
  try {
    if (!ffmpeg.isLoaded()) {
      await ffmpeg.load();
    }
    var concatList = '';
    var i;
    for (i = 0; i < numVideos && i < videoUrls.length; i++) {
      var videoUrl = videoUrls[i];
      console.log(videoUrl)
      ffmpeg.FS('writeFile', 'video' + i + '.mp4', await fetchFile(videoUrl));
      await ffmpeg.run('-i', 'video' + i + '.mp4', '-c', 'copy', '-bsf:v', 'h264_mp4toannexb', '-f', 'mpegts', 'intermediate' + i + '.ts');
      concatList += 'intermediate' + i + '.ts|';
    }
    concatList = concatList.slice(0, -1); // Remove the last '|'
    console.log(concatList)
    await ffmpeg.run('-i', 'concat:' + concatList, '-c', 'copy', '-bsf:a', 'aac_adtstoasc', 'output.mp4');

    const data = ffmpeg.FS('readFile', 'output.mp4');
    const video = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));

    downloadLink.href = video;
    downloadLink.download = 'output.mp4';
    downloadLink.style.display = 'block';

    if (i < numVideos) {
      addButton.click();
    }
  } catch (error) {
      console.error('An error occurred:', error);

    //   await trimVideo(0, 1000);

      mergeVideos(numVideos);

  }
  
}

    mergeButton.addEventListener('click', function() {
    var numVideos = videoUrls.length; 
    mergeVideos(numVideos);

    });

    var message_button = document.querySelector("#message-form");
    document.getElementById('input_video').style.display = 'none';
    document.getElementById('start_time').style.display = 'none';
    document.getElementById('end_time').style.display = 'none';
    document.getElementsByClassName('trimming_button')[0].style.display = 'none';
    
    
    function checkLoader() {
      var loader1 = document.querySelector('.loader-con');
      if (loader1) {
        loader1.style.display = 'none';
      }
    } 
    
    var intervalId = setInterval(checkLoader, 1000);

    message_button.addEventListener("submit", function(e) {
    e.preventDefault();
    var content = document.querySelector("#message-input").value
    var gifUrl;  
    if (!content.includes('merge') && !content.includes('download') && !content.includes('compress') && !content.includes('trim') && !content.includes('convert') && !content.includes('add image and video'))  {
    fetch(`https://api.giphy.com/v1/gifs/search?api_key=B3605Y95fDsAEosLrcNQmahCQpL8SwF8&q=${encodeURIComponent(content)}`)
    .then(response => response.json())
    .then(data => {
    gifUrl = data.data[0].images.original.url;
    var title = data.data[0].title; 
    var duration = 2
    let parentElement = document.querySelector('#videos');
    
    if (!parentElement) {
      parentElement = document.createElement('div');
      parentElement.id = 'videos';
      document.body.appendChild(parentElement);
    }
    
    let paginationData = parentElement.querySelector('.row.paginationData');
    if (!paginationData) {
      paginationData = document.createElement('div');
      paginationData.className = 'row paginationData';
      parentElement.appendChild(paginationData);
    }
    
    let childDiv1 = document.createElement('div');
    childDiv1.className = "col-6 col-md-4 col-lg-5 col-xl-4 mt-3";
    paginationData.appendChild(childDiv1);
    let childDiv2 = document.createElement('div');
    childDiv2.className = 'single-media video-file';  
    childDiv2.setAttribute('draggable', 'true');
    childDiv2.setAttribute('title', title + '.mp4');  
    childDiv2.setAttribute('data-duration', duration); 
    childDiv1.appendChild(childDiv2);
    var imgElement = document.createElement("img");
    imgElement.className = "media_file";
    imgElement.setAttribute('muted', '');
    childDiv2.appendChild(imgElement);

    var videoElement = document.createElement("video");
    videoElement.className = "media_file";
    videoElement.setAttribute('muted', '');
    videoElement.setAttribute('autoplay', '');
    videoElement.setAttribute('loop', '');
    childDiv2.appendChild(videoElement);

    var addToTimelineButton = document.createElement("button");
    addToTimelineButton.className = "addToTimeline";
    addToTimelineButton.innerHTML = '<i class="fa fa-plus"></i>';
    childDiv2.appendChild(addToTimelineButton);
    var otherButton = document.querySelector("body > button:nth-child(18)");

    addToTimelineButton.addEventListener('click', function() {
        var checkInterval = setInterval(function() {
            if (videoUrls && videoUrls.length > 0) { 
            console.log(videoUrls)
            console.log(videoUrls.length)
                console.log("button clicked");
                otherButton.click();
                clearInterval(checkInterval);
            } else {
                console.log("videoUrls is not defined or empty");
            }
        }, 1000);
    });

    var deleteVideoButton = document.createElement("button");
    deleteVideoButton.className = "deleteVideo";
    deleteVideoButton.innerHTML = '<i class="far fa-trash-alt"></i>';
    childDiv2.appendChild(deleteVideoButton);
    fetch(gifUrl)
      .then(response => response.blob())
        .then(blob => {
          var reader = new FileReader();
          reader.onloadend = function() {
            var base64data = reader.result;
            imgElement.src = base64data;
            videoElement.src = base64data;
            var blobUrl = URL.createObjectURL(blob);
            childDiv2.setAttribute('data-for-video', blobUrl);
          }
          reader.readAsDataURL(blob);
        });
      })
    setTimeout(function() {
    var elements = document.getElementsByClassName("single-media video-file");
    console.log('elements :>> ', elements);
    for (var i = 0; i < elements.length; i++) { 
        console.log('elements.length :>> ', elements.length);
        elements[i].addEventListener("dragstart", function(event) {
            var imageUrl = gifUrl;
            console.log('imageUrl :>> ', imageUrl);
            var element = document.querySelector(".canvas-container");
            var img = document.createElement('img');
            img.src = imageUrl;
            img.className = "canvas-container"; 
            // element.appendChild(img);
            
            var newDiv = document.createElement('div');
            newDiv.className = "single-item without-events active";
            var innerDiv = document.createElement('div');
            innerDiv.className = "img";
            var thumbnail = document.createElement('img');
            thumbnail.src = imageUrl; // Set the src to the gifUrl
            thumbnail.className = "thumbnail";
            thumbnail.alt = "thumbnail";
            innerDiv.appendChild(thumbnail);
            newDiv.appendChild(innerDiv);
            var editingArea = document.querySelector(".video-area.edit-area.ui-sortable");
            editingArea.appendChild(newDiv);
            var parentElement = document.querySelector(".video-area.edit-area.ui-sortable");
            console.log('parentElement :>> ', parentElement);
            var imgElements = parentElement.getElementsByTagName('img');
            var gifUrls = [];
            
            for (var i = 0; i < imgElements.length; i++) {
                gifUrls.push(imgElements[i].src);
            }
            
            console.log(gifUrls);
            gifUrls = gifUrls.slice(1);
            console.log(gifUrls);
            var serverUrl = "https://intermediate-catkin-ruby.glitch.me/";
     
            var thumb = document.querySelector("body > section > div > div.col-12.editing-area > div > div > div.video-slider .thumb");
            var sliderElement = document.querySelector("body > section > div > div.col-12.editing-area > div > div > div.video-slider");



var line = document.createElement("div");
line.style.width = "0.1px";
line.style.height = '1200px';
line.style.backgroundColor = "white";
line.style.position = "absolute";
line.style.bottom = "0";
sliderElement.appendChild(line);

var isMouseDown = false;
thumb.addEventListener("mousedown", function(event) {
    isMouseDown = true;
}); 
window.addEventListener("mouseup", function(event) {
    isMouseDown = false;
}); 
sliderElement.addEventListener("mousemove", function(event) {
    if (isMouseDown) {
        var x = (event.clientX - sliderElement.getBoundingClientRect().left);
        thumb.style.transform = "translateX(" + (x / 2) + "px)"; 
        line.style.transform = "translateX(" + (x / 2)  + "px)";
        // Move the .video-slider along with the thumb
        var slider = document.querySelector('.video-slider');
        slider.style.transform = "translateX(" + (x / 2)  + "px)";
        console.log('slider4444444444 :>> ', slider);
    }
});

fetch(serverUrl, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
    body: JSON.stringify({
        urls: gifUrls
    }),
})  
.then(response => response.blob())
.then(data => {
    console.log('Success:', data);
    var urlCreator = window.URL || window.webkitURL;
    console.log('urlCreator :>> ', urlCreator);
    var imageUrl = urlCreator.createObjectURL(data);
    var canvas_container = document.querySelector(".canvas-container")
    var img = document.createElement('img');
    img.src = imageUrl;
    img.className = "canvas-container"; 
    canvas_container.appendChild(img);
    console.log('imageUrl :>> ', imageUrl);
    console.log('canvas_container :>> ', canvas_container);
    var saveVideoButton = document.querySelector("#save-video");
    saveVideoButton.addEventListener("click", function() {
                        var gifElement = document.querySelector("body > section > div > div.col-md-6.video-preview > div > div > div.canvas-container > img");
                        if (gifElement) {
                            var a = document.createElement('a');
                            a.href = gifElement.src;
                            a.download = 'output.gif';
                            a.click();
                        } else {
                            console.log("No GIF found");
                        }
                    }); 
    })

.catch((error) => {
console.error('Error:', error);
                    });
                    });
                }
            }, 1000);
    };
});

document.getElementById('save-video').addEventListener('click', function() {
    console.log("button clicked ");
    var videoElements = document.querySelectorAll('.single-item video');
    videoElements.forEach(function(videoElement, index) {
        var url = videoElement.src;
        console.log('url :>> ', url);
        console.log('videoElement :>> ', videoElement);
        var a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = 'video_part_' + (index + 1) + '.mp4'; // name each part separately
        document.body.appendChild(a);
        a.click();
        setTimeout(function() {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);  
        }, 100);
    });
});

var submitButton1 = document.querySelector('input[type="submit"]');

      function extractNumber1(str) {
        console.log('str :>> ', str);
        if (typeof str === 'string') {
          const num = str.replace(/[^0-9.]/g, '');
          console.log('num :>> ', num);
          return num ? parseFloat(num) : '';
        } else {
          console.log('Error: Input is not a string');
          return '';
        }
      } 
      


let imageUrls = [];

submitButton1.addEventListener('click', async function() {
    var textarea = document.getElementById('message-input');
    if (textarea.value) {
        var match = textarea.value.match(/\d+/g);
        console.log('match :>> ', match);
        console.log('videoUrls :>> ', videoUrls);
        console.log('videoUrls.length :>> ', videoUrls.length);
         
         const trimwords = 'trim|cut|edit|crop|snippet|shorten|reduce|shrink|condense|abstract|prune|slim|thin|shave|clip|curtail|decrease|diminish|downsize|lessen|attenuate|concentrate|abridge|contract|abbreviate|narrow|truncate|prune|lower|minimize|tighten|slice|truncate|chop|chisel|pare|skive|slash|dock|lop|nibble|reengage|ream|detract|deduct';

        const mergewords ='merge|combine|join|unite|blend|fuse|coalesce|connect|assemble|integrate|conjunction|consolidate|meld|mixture|junction|join|unification|union|alliance|coalition|junction|association|bonding|affiliation|partnership|kinship|convergence|gathering|composition|montage|collation|put together|intermix|interfuse|interlace|interdigitate|interthread|interknit|interweave|entwine|commingle|amalgamate|coadunate|embody with|join together|put together with|desegregate|synthesize|put together in|interim|interpoint' ;

        const convertwords = 'convert|transcode|transform|transpose|change|turn|rewrite|rework|remake|metamorphose|transpose|adapt|alter|vary|modification|passage|transition|translation|adjustment|consummation|flux|rendition|redaction|refashioning|tweak|tweakage|reorganization|recast|remodeling|rekey|reform|regenerate|make over|model over|worked over|modification|modulating|shifting|variation|modulation|qualitative change| editions|arrangements|interpretations|performances|presentations|studies|treatments|variations on|in various keys|in various manners|in various tones|with new text|with new music'


        const compresswords = 'compress|condense|compact|constrict|contract|decrease|diminish|lessen|minimize|reduce|shrink|squeeze|tighten|press|crush|squash|compactify|constrict|conglobate|consolidate|concentralize|concentrate|conglobated|packed|crammed|crushed|squeezed|squoze|squashed|mangled|pinched|crimped|shriveled|squeezy|stuffy|airless|breathless|crowded|enclosed|limited|narrow|tight|bound|boxed|bunched up|bunched together|clamped|confined|congested|constrained|cramped|latched|locked|pressed|sealed|secured|shut|tiny|wedged|zipped'
        
        const backgroundwords = 'backdrop|behind|backing|screen|scenery|setting|environment|surroundings|backplate|matte|fill|composite|insert|key|incrust|layer|mount|interpose|back project|rear project|superimpose|inset|embed|implant|integrate |place|position|put|set|situate|establish shot|master shot|medium long shot|three shot|over the shoulder shot|point of view shot|reaction shot|two shot|foreground|md-ground|backdrop|backing|matte painting|plate shot|location|scene|scenario|ambience|atmosphere|background|circumstances|context|environment|habitat|backcloth|cyclorama|diorama|model|set|furniture|backings|backcloths|backdrops|cycs|groundrows|scenic elements';
        
const removebackgroundwords = 'remove background|delete background|erase background|take off background|subtract background|discard background|get rid of background|trash background|scrap background|junk background|void background|cancel background|reverse background|undo background|fix background|mend background|debug background|background removal|background elimination|background clearing|background subtraction|unicolor background|blue screening|chroma keying|green screening|keying out|matte extraction|rotoscoping|garbage matte|hold-out matte|suppress background|wash out background|replace background|cut out background|mask out background|contest background|lift background|yank background|background change|background swap|background switch|background shift|background reshape|background alteration|background modification|background edit|background revision|background convert|background conversion|background redesign|background remodeling|background makeover|background reskin|background refresh|background update';

   const changebackwords =  'change background|alter background|modify background|convert background|swap background|switch background|shift background|reshape background|adjust background|revision background|redesign background|remodel background|makeover background|reskin background|refresh background|update background|new background|replaced background|exchanged background|traded background|flipped background|flopped background|reversed background|transposed background|turned around background|rewritten background|reworked background|remade background|regenerated background|revamped background|adapted background|amended background|became different background|grew different background|turned into different background|underwent change background|underwent metamorphosis background|underwent mutation background|underwent transformation background|twist background|variations on a theme background|departures from background|deviations from background|diversions from background|rotations of background|departures from the standard background|new incarnations of background|additions to background|innovations in background';


const addimagevideowords = 'add images and videos|insert photos and footage|incorporate pictures and film|blend graphics and motion content|combine photos and video clips|integrate drawings and movie segments|fuse illustrations and video snippets|amalgamate stills and film sequences|overlay images on videos|superimpose photos over movies|juxtapose graphic elements and filmed content|intercut pictures with video segments|interleave artwork and video clips|interpose infographic slides between footage|Successively display image frames and video|cut between rendered visuals and live action|segue from digital paintings to cinematography  |Gather together mixed visual media|collect assorted graphical and video content|assemble varied still and moving imagery|aggregate drawn and videographic materials|cumulate graphic and videotaped artifacts|compile static and dynamic visual data';

        const speedupwords = 'speed up|make faster|quicken|accelerate|expedite|hurry|step on it|put a move on|hasten|rush|burn rubber|make haste|get a wiggle on|get cracking|get hopping|get rattling|increase velocity|crank up the pace|advance timing|uprate tempo|upgrade frequency|boost rate|energize flow|intensify flux|amplify vigor|heighten intensity|escalate momentum|raise motion|enhance activity|intensify liveliness|build up strength|magnify power|boost capability|add speed|add velocity|add pace|add momentum|faster|brisk|rapid|swift|winged-foot|mercurial|nimble|quick|racing|rushing about|darting about|hastening|hotfooting|stepping on it|tearing|whizzing|zipping';
        
        const slowdownwords = 'slowdown|slow|delay|decelerate|sluggish|lagging|lethargic|plodding|crawling|inching|lackadaisical|listless|languid|lazy|idle|halting|pausing|hesitating|faltering|slowing|dawdling|lingering|loitering|prolonging|procrastinating|deferring|postponing|prolix|long-winded|tedious';
        

        const addtextword = ''

        console.log("",textarea.value.toLowerCase())
        console.log("",textarea.value.toLowerCase().includes(trimwords))
        console.log(trimwords.split('|').some(word => textarea.value.toLowerCase().includes(word)))
        
        if (trimwords.split('|').some(word => textarea.value.toLowerCase().includes(word))) {
            alert("Trimming will start121212122");
            // Assuming 'match' is defined elsewhere
            var startTime = match && match.length > 0 ? match[0] : 0;
            console.log(startTime)
            var endTime = match && match.length > 1 ? match[1] : 1;
            console.log(endTime)
            trimVideo(startTime, endTime);
            console.log("Function will work now");
        }
            
            else  if (mergewords.split('|').some(word => textarea.value.toLowerCase().includes(word))) {
                console.log(match)
                console.log(mergewords.split('|').some(word => textarea.value.toLowerCase().includes(word)))

            numVideosToMerge = match ? parseInt(match[0]) : 0;
            console.log('numVideos :>> ', numVideosToMerge);
            if (videoUrls.length < numVideosToMerge) {
                var button = document.querySelector("body > button:nth-child(17)") || document.querySelector("#add_video");
                var difference = numVideosToMerge - videoUrls.length;
                console.log(difference)
                for (var i = 0; i < difference; i++) {
                    button.click();
                    console.log("uplaoding a new button")
                }
            }
            console.log('videoUrls :>> ', videoUrls);
            mergeVideos(numVideosToMerge);
        
                
        }
        else if (convertwords.split('|').some(word => textarea.value.toLowerCase().includes(word))) {
     
            console.log(convertwords)
            const supportedFormats = ["mp4", "mkv", "avi", "mov", "flv", "wmv"];
            console.log(supportedFormats)
            const userInput = document.querySelector("#message-input").value;
            console.log(userInput)
            let outputFormat;
            console.log(supportedFormats)
            if (supportedFormats.includes(userInput.toLowerCase())) {
               outputFormat = userInput;
               console.log(outputFormat)
            }
            else {
               outputFormat = "webm";
               console.log(outputFormat)
               console.warn(`Unsupported file format: ${userInput}. Using "webm" as the default.`);
            }
            
            console.log(`Selected output format: ${outputFormat}`);
    
            const mimeTypes = {
                mp4: "video/mp4",
                mkv: "video/x-matroska", 
                avi: "video/avi",
                mov: "video/quicktime",
                flv: "video/x-flv",
                wmv: "video/x-ms-wmv",
                webm: "video/webm"  // Add this line

            };
            
        //  outputFormat = 'webm'; // Now 'webm' is a valid format
                    
            if (outputFormat in mimeTypes) {
                console.log(mimeTypes[outputFormat]);
            } else {
                console.log(`Invalid format: ${outputFormat}`);
            }       
            console.log(outputFormat)
            console.log(mimeTypes)
            console.log(mimeTypes[outputFormat])
            convertVideo(outputFormat, mimeTypes[outputFormat]);
        }
        
        else if (textarea.value.toLowerCase().startsWith('download')) {

        let button1 = document.querySelector("#save-video > i");
        button1.click();
        
        let button2 = document.querySelector("body > a");
        button2.click();}

        else if (textarea.value.toLowerCase().includes(compresswords)) {
            await compressVideo();
            console.log("Compression completed and video downloaded");}
        
        else if (textarea.value.toLowerCase().includes(backgroundwords)) {
            document.querySelector('.single-option[data-target="#category-7"]').click();
            let searchButton = document.querySelector('.fas.fa-search');
            let keyword = document.querySelector("#message-input").value; 
            searchButton.click();
            
            let imageUrl = `https://source.unsplash.com/400x400/?${encodeURIComponent(keyword)}`;
            let imageHTML = `
            <div class="single-media single-icon icons" data-for-icon="${imageUrl}" draggable="false" data-type="png">
            <img src="${imageUrl}" alt="media_file" class="media_file">
              <button class="addToTimeline">
                <i class="fa fa-plus"></i>
              </button>
            </div>
            `;

            try {
                if (div && imageHTML) {
                    div.innerHTML += imageHTML;
                } else {
                    throw new Error('Either div or imageHTML is undefined');
                }
            } catch (error) {
                console.error(error);
            }

                imageUrls.push(imageUrl);
                console.log(imageUrls)
                let div = document.querySelector("#category-7 > div.row.paginationData");
                let img = document.createElement('img');
                img.crossOrigin = "anonymous"; 
                img.onload = () => {
                  div.appendChild(img);}
                img.onerror = (err) => {
                  console.log("Error loading image", err);
                  alert("error please try again")}
                img.src = imageUrl;}

else if (textarea.value.toLowerCase().startsWith(removebackgroundwords)) {
    let fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.id = 'fileInput';
    fileInput.className = 'yourClassName';

    let displayImage = document.createElement('img');
    displayImage.id = 'displayImage';

    document.body.appendChild(fileInput);
    document.body.appendChild(displayImage);
    // console.log(url)
    const url = 'https://sdk.photoroom.com/v1/segment';
    const apiKey = "2178b365166a9c47283a57eee177fdad32391101";
    console.log(apiKey)
    async function removeBackground(imageFile) {
        const formData = new FormData();
        formData.append('image_file', imageFile);
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'X-Api-Key': apiKey
            },
            body: formData
        });
        if (!response.ok) {
            console.error(await response.json());
            throw new Error('Network response was not ok');
        }
        const imageBlob = await response.blob();
        return imageBlob;
    }
    if (imageUrls.length > 0) {
        const imageUrl = imageUrls[imageUrls.length - 1]; // Get the last URL
        const response = await fetch(imageUrl);
        const imageBlob = await response.blob();
        try {
            const outputBlob = await removeBackground(imageBlob);
            const objectURL = URL.createObjectURL(outputBlob);
            document.getElementById('displayImage').src = objectURL;
            let downloadLink = document.createElement('a');
            downloadLink.href = objectURL;
            downloadLink.download = 'output.jpg';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        } catch (error) {
            console.error('Error:', error);
        }
    } else {
        fileInput.click();
    }
    document.getElementById('fileInput').addEventListener('change', async () => {
        const files = document.getElementById('fileInput').files;
        if (files && files.length > 0) {
            try {
                const imageBlob = await removeBackground(files[0]);
                const objectURL = URL.createObjectURL(imageBlob);
                document.getElementById('displayImage').src = objectURL;

                let downloadLink = document.createElement('a');
                downloadLink.href = objectURL;
                downloadLink.download = 'output.jpg';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            } catch (error) {
                console.error('Error:', error);
                }
            }
        });
    }

else if (textarea.value.toLowerCase().startsWith(changebackwords)) {

console.log("changing background")
console.log(imageUrls)
console.log(imageUrls.length)

if (imageUrls.length == 0){
const body = document.body;
console.log(body)
const form = document.createElement("form");
body.appendChild(form);
console.log(form)
const fileInput = document.createElement("input");
fileInput.type = "file";
form.appendChild(fileInput);
fileInput.click();

const textInput = document.createElement("input");
textInput.type = "text";
textInput.value = document.querySelector("#message-input").value;
form.appendChild(textInput);

const submitButton = document.createElement("input");
submitButton.type = "submit";
submitButton.value = "Submit";
form.appendChild(submitButton);
fileInput.addEventListener("change", generateImage);

const apiKey = "2178b365166a9c47283a57eee177fdad32391101";
const url = "https://beta-sdk.photoroom.com/v1/instant-backgrounds"; 
form.click()
form.addEventListener("submit", generateImage);

async function generateImage(event) {
    try {
        const file = fileInput.files[0];  
        console.log(file)
        let text = textInput.value;
        console.log(text)
        const formData = new FormData();
        console.log(formData)
        formData.append("imageFile", file);
        let modifiedText = text.replace('change background', '');
        console.log(modifiedText)
        formData.append("prompt", modifiedText);
        console.log(modifiedText)
        console.log('text :>> ', modifiedText);
        console.log('file :>> ', file);
        
        const response = await fetch(url, {
        method: "POST",
        headers: {
            "Accept": "image/png",  
            "x-api-key": apiKey
        },
        body: formData  
        });

        const blob = await response.blob();
        const imageUrl = URL.createObjectURL(blob);
        console.log(blob)
        
        const a = document.createElement("a");
        a.href = imageUrl;
        a.download = "image.png";
        body.appendChild(a);
        a.click();
        console.log(a);
        body.style.backgroundImage = `url(${imageUrl})`;
        const mediaDiv = document.createElement('div');
        mediaDiv.className = 'single-media video-file';
        mediaDiv.setAttribute('data-for-video', imageUrl);
        console.log(imageUrl)
        mediaDiv.setAttribute('draggable', 'true');

        const imgElement = document.createElement('img');
        imgElement.src = imageUrl;
        imgElement.className = 'media_file';
        imgElement.setAttribute('muted', '');
        mediaDiv.appendChild(imgElement);

        const deleteButton = document.createElement('button');
        deleteButton.className = 'deleteVideo';
        deleteButton.innerHTML = '<i class="far fa-trash-alt"></i>';
        mediaDiv.appendChild(deleteButton);

        const addButton = document.createElement('button');
        addButton.className = 'addToTimeline';
        addButton.innerHTML = '<i class="fa fa-plus"></i>';
        mediaDiv.appendChild(addButton);
        const panelElement = document.querySelector('.panel.scrollbar.scrollbar_dark.active');
        const mediaPanelElement = document.querySelector('.panel.scrollbar.scrollbar_dark.mediaPanel.active');

    if (panelElement || mediaPanelElement) {
        let divElement = document.querySelector('.row.paginationData');
        
        if (!divElement) {
            divElement = document.createElement('div');
            divElement.className = 'row paginationData';
            body.appendChild(divElement);
        }
        
        divElement.appendChild(mediaDiv);
        
    } else {
        const categoryElement =document.querySelector('#category-7 .row.paginationData');
        console.log(categoryElement)
        if (categoryElement) {
            categoryElement.appendChild(mediaDiv);
            const imgElement = document.createElement('img');
            imgElement.src = imageUrl;
            console.log('imageUrl :>> ', imageUrl);
            console.log('categoryElement :>> ', categoryElement);
            categoryElement.appendChild(imgElement)   
            console.log('imgElement :>> ', imgElement);
        }
        else {
            console.log('The element with id "category-7" does not exist at this time.');
        }    
      }
    } 
    catch (error) {
        console.error(error);
        alert(error)
        }
    } 
}

if (imageUrls.length > 0) {
    console.log(imageUrls);
    console.log('imageUrls.length :>> ', imageUrls.length);
    const imageUrl = imageUrls[0];

    console.log("Background change will start");
    const apiKey = "2178b365166a9c47283a57eee177fdad32391101";

    fetch('https://sdk.photoroom.com/v1/segment', {
        method: 'POST',
        headers: {
            'X-API-Key': apiKey
        },
        body: JSON.stringify({
            'image_url': imageUrl
        })
    })
    .then(response => response.blob())
    .then(blob => {
        console.log("Background change completed");
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'output.png';
        link.click();
    })
    .catch(error => console.error(error));
}

    }  

else if (textarea.value.toLowerCase().startsWith(addimagevideowords)){
    console.log('imageUrls :>> ', imageUrls);
    console.log('videoUrls :>> ', videoUrls);

if (!imageUrls.length) {
    const imageButton = document.querySelector("#image > div.py-3.m-0 > div > div.col-lg-6.col-8 > input");
    if (imageButton) {
        imageButton.click();
    } else {
        console.log('The image upload button does not exist at this time.');
    }
}

if (!videoUrls.length) {
    const videoButton = document.querySelector("#videos > div.no-data-found.content-center > div > label > span > i");
    if (videoButton) {
        videoButton.click();
    } else {
        console.log('The video upload button does not exist at this time.');
    }
        }
        checkUrls2()    
        }
    
else if (textarea.value.toLowerCase().startsWith(speedupwords)){
    await speedUpVideo();
    console.log("")    
    alert("china in the news")
tr
}

else if (textarea.value.toLowerCase().startsWith(slowdownwords)){
    await slowDownVideo();
    console.log("")    
    alert("china in the news")

}

else if (textarea.value.toLowerCase().startsWith(addtextword)){
const input = document.querySelector("#message-input").value;
const text = input;

const numberRegex = /\d+/g;

const numbers = input.match(numberRegex);

let x = 0;
let y = 0;

if(numbers && numbers.length > 0) {
  x = parseInt(numbers[0]);
}

if(numbers && numbers.length > 1) {
  y = parseInt(numbers[1]); 
}
const input1 = input
addText(input1, x, y);

    console.log("")    
    alert("china in the news")

}

}
    
document.querySelector('div[data-target="#category-7"]').addEventListener('click', function(e) {
    alert("burton buton")
    e.preventDefault();
    alert('Button clicked!');
});

async function compressVideo() {
    try {
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        await ffmpeg.load();

        const inputVideo = await fetchFile(videoUrls[0]);
        console.log("inputideo",inputVideo)
        ffmpeg.FS('writeFile', 'input.mp4', inputVideo);

        await ffmpeg.run('-i', 'input.mp4', '-c:v', 'libx264', '-crf', '35', '-preset', 'ultrafast', 'output.mp4');

        const outputVideo = ffmpeg.FS('readFile', 'output.mp4');

        const outputVideoBlob = new Blob([outputVideo.buffer], { type: 'video/mp4' });

        const outputVideoUrl = URL.createObjectURL(outputVideoBlob);

        const link = document.createElement('a');
        link.href = outputVideoUrl;
        link.download = 'output.mp4';
        link.click();

        console.log("Compression completed and video downloaded");
            } catch (error) {
                console.error('An error occurred:', error);
            }
        }
});

async function processVideos() {

    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });

    await ffmpeg.load();

    console.log(videoUrls);
    console.log(imageUrls);
    
    for (let i = 0; i < videoUrls.length; i++) {

        const video = await fetchFile(videoUrls[i]);
        const image = await fetchFile(imageUrls[i]);

        ffmpeg.FS('writeFile', `video${i}.mp4`, video);
        ffmpeg.FS('writeFile', `image${i}.jpg`, image);

        await ffmpeg.run('-i', `video${i}.mp4`, '-i', `image${i}.jpg`, '-filter_complex', '[0:v][1:v] overlay=0:0', `output${i}.mp4`);

        const output = ffmpeg.FS('readFile', `output${i}.mp4`);

        const url = URL.createObjectURL(new Blob([output.buffer], { type: 'video/mp4' }));

        document.querySelector(`#video${i}`).src = url;
    }
}

async function slowDownVideo() {
    try {
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });
        await ffmpeg.load();

        const inputVideo = await fetchFile(videoUrls[0]);
        ffmpeg.FS('writeFile', 'input.mp4', inputVideo);
        const speedpoints = extractNumber1(document.querySelector("#message-input").value) || 2;

        await ffmpeg.run('-i', 'input.mp4', '-vf', 'setpts=speedpoints*PTS', 'output.mp4');

        const outputVideo = ffmpeg.FS('readFile', 'output.mp4');
        const outputVideoBlob = new Blob([outputVideo.buffer], { type: 'video/mp4' });
        const outputVideoUrl = URL.createObjectURL(outputVideoBlob);

        const link = document.createElement('a');
        link.href = outputVideoUrl;
        link.download = 'output.mp4';
        link.click();

        console.log("Slow down completed and video downloaded");
    } catch (error) {
        console.error('An error occurred:', error);
    }
}

async function speedUpVideo() {
    if(!videoUrls || !videoUrls.length) {
  throw new Error('No video URL provided'); 
}

    try {
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });
        console.log("1111111111111111111",ffmpeg)
        await ffmpeg.load();
        const inputVideo = await fetchFile(videoUrls[0]);
        console.log("22222222222222222",inputVideo)
        ffmpeg.FS('writeFile', 'input.mp4', inputVideo);
        console.log(ffmpeg)
        const speedpoints = extractNumber1(document.querySelector("#message-input").value) || 2;

        await ffmpeg.run('-i', 'input.mp4', '-vf', 'setpts=PTS / speedpoints', 'output.mp4');
        const outputVideo = ffmpeg.FS('readFile', 'output.mp4');
        console.log("33333333333333333",outputVideo)
        const outputVideoBlob = new Blob([outputVideo.buffer], { type: 'video/mp4' });
        const outputVideoUrl = URL.createObjectURL(outputVideoBlob);
        const link = document.createElement('a');
        link.href = outputVideoUrl;
        link.download = 'output.mp4';
        link.click();
        console.log(link)
        console.log("Speed up completed and video downloaded");
    } catch (error) {
        console.error('An error occurred:', error);
    }
}

const input = document.querySelector("#message-input").value;
const text = input;

const numberRegex = /\d+/g;

const numbers = input.match(numberRegex);

let x = 0;
let y = 0;

if(numbers && numbers.length > 0) {
  x = parseInt(numbers[0]);
}

if(numbers && numbers.length > 1) {
  y = parseInt(numbers[1]); 
}

async function addText(text, x, y) {
    console.log("adding text to video")
    if (!videoUrls || !videoUrls.length) {
      throw new Error('No video URL provided');
    }

    try {
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });

    await ffmpeg.load();

    const inputVideo = await fetchFile(videoUrls[0]);
    ffmpeg.FS('writeFile', 'input.mp4', inputVideo);

    await ffmpeg.run('-i', 'input.mp4', '-vf', `drawtext=text='${text}':x=${x}:y=${y}`, 'output.mp4');

    const outputVideo = ffmpeg.FS('readFile', 'output.mp4');
    const outputVideoBlob = new Blob([outputVideo.buffer], { type: 'video/mp4' });
    const outputVideoUrl = URL.createObjectURL(outputVideoBlob);

    const link = document.createElement('a');
    link.href = outputVideoUrl;
    link.download = 'output.mp4';
    link.click();

    console.log("Text added to video and downloaded");
  } catch (error) {
    console.error('An error occurred:', error);
  }
}

async function convertVideo(outputFormat,  mimeTypes) {
  const { createFFmpeg, fetchFile } = FFmpeg;


  console.log(mimeTypes)
  console.log(videoNames)
  //   alert(videoNames)
    alert(formats)
    console.log(formats)
  const ffmpeg = createFFmpeg({ log: true });
  console.log(`Converting to ${outputFormat}`);
  await ffmpeg.load();
  const inputVideo = await fetchFile(videoUrls[0]);
  ffmpeg.FS('writeFile', `input.${formats[0]}`, inputVideo);
  
  if (formats[0] !== 'mp4') {
      console.log(formats[0])

    const inputVideoFile = `input.${formats[0]}`;

    convertToMP4(inputVideoFile);

      
  }

  
  if (formats[0] == 'mp4') {

alert(formats[0] + '11111111111111111111')
//   await ffmpeg.run('-i', `input.${formats[0]}`, '-c:v', 'libvpx', '-preset', 'veryfast', '-b:v', '4M', '-c:a', 'libfdk_aac', `output.${outputFormat}`);
console.log(formats[0]);
// console.log(`input.${formats[0]}')
try {
    
  await ffmpeg.run('-i', 'input.${formats[0]}', '-c:v', 'libvpx', '-b:v', '1M','-preset', 'ultrafast', '-c:a', 'libvorbis','-crf', '30',  'output.${outputFormat}');
  console.log('Video conversion completed successfully');
} catch (error) {
  console.error('An error occurred during video conversion:', error);
}

try {
  const outputVideo = ffmpeg.FS('readFile', 'output.${outputFormat}');
  console.log('Video read successfully');
} catch (error) {
  console.error('An error occurred while reading the video file:', error);
}
  
  console.log(outputVideo)
  const outputVideoBlob = new Blob([outputVideo.buffer], { type: mimeTypes });
  console.log(outputVideoBlob)
  console.log(outputVideoBlob);
  const outputVideoUrl = URL.createObjectURL(outputVideoBlob);
  console.log(outputVideoUrl);
  videoUrls.push(outputVideoUrl);
  console.log(videoUrls)
  const link = document.createElement('a');
  console.log(link);
  link.href = outputVideoUrl;
  link.download = 'output.${outputFormat}';
  link.click();
  console.log("Conversion completed and video downloaded");
  console.log(link)


      
  }

async function convertToMP4(inputFile) {
  alert("mp4 will statr to convert")
  alert(inputFile)
  if (!ffmpeg.isLoaded()) {
    await ffmpeg.load();
  }
  console.log("input.mp4")
  console.log(formats[0])
  ffmpeg.FS('writeFile', 'input.${formats[0]}', await fetchFile(inputFile));
  alert("conversion will start")
  
  await ffmpeg.run('-i', 'input.${formats[0]}', '-c:v', 'libx264', '-crf', '23', 'output.mp4');
  
  const data = ffmpeg.FS('readFile', 'output.mp4');
  alert(data)
  const downloadLink = document.createElement('a');
  alert(downlaodLink)
  downloadLink.href = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
  downloadLink.download = 'output.mp4';
  alert(downloadLink)
  downloadLink.click();

  console.log(downloadLink)
}


}

const myObserver = new MutationObserver((mutationsList, myObserver) => {
    for(let mutation of mutationsList) {
        if(mutation.addedNodes.length) {
            const myImgElement = document.querySelector('.single-media.single-icon.icons img');
            if (myImgElement && myImgElement.src) {
                console.log('The img element has a source.');
                imageUrls.push(myImgElement.src);
                myObserver.disconnect();
            }
        }
    }
});

myObserver.observe(document, { childList: true, subtree: true });

var callback = function(mutationsList, observer) {
    for(let mutation of mutationsList) {
        if (mutation.type === 'childList') {
            let button = document.querySelector('a[download="output.mp4"]');
            if(button){
                setTimeout(function() {
                    button.click();
                    observer.disconnect();
                }, 1000);
            }
        }
    }
};



    const checkUrls2 = () => {
    const intervalId = setInterval(() => {
if (imageUrls.length && videoUrls.length) {
    console.log('Both imageUrls and videoUrls exist');
        
var element1 = document.querySelector('.preventOverlay');
var element2 = document.querySelector('.canvas-container');

if (element1) {
    element1.parentNode.removeChild(element1);
} else {
    console.log('Element .preventOverlay not found');
}

if (element2) {
    element2.parentNode.removeChild(element2);
}
else {
    console.log('Element .canvas-container not found');
}

setTimeout(function() {
  const fullscreenDiv = document.createElement('div');
  fullscreenDiv.style.position = 'fixed';
  fullscreenDiv.style.top = '0';
  fullscreenDiv.style.left = '0';
  fullscreenDiv.style.display = 'flex';
  fullscreenDiv.style.justifyContent = 'center';
  fullscreenDiv.style.alignItems = 'center';
  const container = document.createElement('div');
  container.className = 'ai_container';
  container.style.left = '479.5px';
  container.style.top = '-70.5px';

const video = document.createElement('video');
video.controls = true;
console.log(video)

const source = document.createElement('source');
source.src = videoUrls[0]; 
source.type = 'video/mp4';

video.appendChild(source);

const canvas = document.createElement('canvas');
canvas.id = 'ai_c';

container.appendChild(video);
container.appendChild(canvas);
const videoPlayerDiv = document.querySelector('.videoplayer');

videoPlayerDiv.appendChild(container);
const downloadButton = document.createElement('button');
downloadButton.id = 'ai_download';
downloadButton.textContent = 'Download';
videoPlayerDiv.appendChild(downloadButton);
downloadButton.click();
document.body.appendChild(container);
document.body.appendChild(downloadButton);
var videoElement = document.createElement('video');
videoElement.src = videoUrls[0];
videoElement.style.display = 'none';
document.body.appendChild(videoElement);
var element3 = document.querySelector('.ai_container');
console.log(element3)
element3.style.top  = '70px';
element3.style.left = '690px';
document.querySelector('.vidoe-palyer-options').style.display = 'none';

videoElement.addEventListener('loadedmetadata', function() {
var videoWidth = this.videoWidth;
console.log(videoWidth)
var videoHeight = this.videoHeight;
console.log(videoHeight)
var canvas = new fabric.Canvas('ai_c', { width: window.innerWidth, height: window.innerHeight });
var imgLeftPercent, imgTopPercent, imgWidthPercent, imgHeightPercent;

fabric.Image.fromURL(imageUrls[0], function(img) {
img.on('mousedown', function() {
  canvas.getElement().style.pointerEvents = 'all';
});
img.on('mouseup', function() {
  canvas.getElement().style.pointerEvents = 'none';
});
img.on('modified', function() {
  var currentWidth = img.width * img.scaleX;
  var currentHeight = img.height * img.scaleY;
  imgLeftPercent = (img.left / canvas.width) * 100;
  imgTopPercent = (img.top / canvas.height) * 100;
  imgWidthPercent = (currentWidth / canvas.width) * 100;
  imgHeightPercent = (currentHeight / canvas.height) * 100;
  console.log('left: ' + imgLeftPercent + '%', 'top: ' + imgTopPercent + '%', 'width: ' + imgWidthPercent + '%', 'height: ' + imgHeightPercent + '%');
});
canvas.add(img);
});

document.getElementById('ai_download').addEventListener('click', async function() {
await processVideo(imgLeftPercent, imgTopPercent, imgWidthPercent, imgHeightPercent, videoWidth, videoHeight);
});

async function processVideo(leftPercent, topPercent, widthPercent, heightPercent, videoWidth, videoHeight) {
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log: true });

await ffmpeg.load();

const video = await fetchFile(videoUrls[0]); 
const image = await fetchFile(imageUrls[0]);

ffmpeg.FS('writeFile', 'video.mp4', video);
ffmpeg.FS('writeFile', 'image.png', image);

var left = (leftPercent / 100) * videoWidth;
var top = (topPercent / 100) * videoHeight;
var width = (widthPercent / 100) * videoWidth;
var height = (heightPercent / 100) * videoHeight;
let output;
console.log('Image position and dimensions:', 'left: ' + left, 'top: ' + top);
console.log('width :>> ', width);
console.log('height :>> ', height);
console.log("object");
try {
await ffmpeg.run('-i', 'image.png', '-vf', 'scale=' + width + ':' + height, 'scaled.png');
} catch (error) {
console.error('Error running FFmpeg', error);
}
try {
await ffmpeg.run('-i', 'video.mp4', '-i', 'scaled.png', '-filter_complex', "[0:v][1:v] overlay=" + left + ":" + top, '-c:a', 'copy', '-preset', 'ultrafast', 'output.mp4');
output = await ffmpeg.FS('readFile', 'output.mp4');
} catch (error) {
console.error('Error running FFmpeg', error);}
const url = URL.createObjectURL(new Blob([output.buffer], { type: 'video/mp4' }));
const link = document.createElement('a');
link.href = url;
link.download = 'output.mp4';
link.textContent = 'Download video';
document.body.appendChild(link);
link.click();
}
});
  fullscreenDiv.appendChild(container);
  document.body.appendChild(fullscreenDiv);
}, 1000);
            clearInterval(intervalId);
        } else {
            console.log('none');
        }
    }, 1000); 
};

</script>
</html>
